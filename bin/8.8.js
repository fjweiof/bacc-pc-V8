webpackJsonp([8],{161:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return e.charAt(0).toUpperCase()+e.slice(1)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=(n(18),n(81)),r=(n(23),n(22)),s=r.fstr,c=r.fstr2num,d=(n(28),n(10),n(92)),u=n(162),h=(u.BeadPlate,u.BigRoad,u.BigEye,laya.net.Loader),g=laya.utils.Handler,f=function(){function e(t){i(this,e),this.opt=t}return l(e,[{key:"assignAllBtns",value:function(){for(var e=this,t=this._view._children,n=/[A-Za-z]\d+/,i=0;i<t.length;i++){var l=t[i].asButton;if(l instanceof fairygui.GButton){var a=function(){if(n.test(l.name))return"continue";var t=l.name.split("."),i=t[1]||1;t=t[0];var a=e._view.getController(t);a?(l.onClick(e,function(){a.selectedIndex=i}),a.setSelectedIndex(0)):l.onClick(e,function(){var e=o(t)+"Win";if(d[e])var n=new d[e];else var n=new d.Win(t);n.modal=!0,n.show()})}();if("continue"===a)continue}}}},{key:"active",value:function(){0==this._view.getController("isAdmin").selectedIndex&&this.enterGame()}},{key:"enterGame",value:function(){fairygui.GRoot.inst.showModalWait(),_socket.sendp({c:"alltables"}),netmsg.once("alltables",this,function(e){fairygui.GRoot.inst.closeModalWait(),console.log(e),this.tables=[];for(var t in e.tables)e.tables[t].roomid=t,this.tables.push(e.tables[t]);var n=this.tables.length;n>1&&console.log("桌子数量不唯一，请检查服务器以及数据库"),_socket.sendp({c:"join",code:this.tables[0].roomid})})}}],[{key:"create",value:function(t,i){"function"==typeof t&&(i=t,t={}),Laya.loader.load([{url:n(152),type:h.IMAGE},{url:n(153),type:h.IMAGE},{url:n(155),type:h.BUFFER}],g.create(null,function(){window.magiclink&&magiclink.reg(function(e){console.log("magiclink ret",e),_socket.sendp({c:"join",code:e})});var n=new e(t);fairygui.UIPackage.addPackage("baijiale"),fairygui.UIConfig.buttonSound=null,fairygui.UIConfig.buttonSoundVolumeScale=0;var o=n._view=fairygui.UIPackage.createObject("Package1","hall").asCom;o.getController("isAdmin").selectedIndex=a.isAdmin?1:0;var l=o.getChild("n33");l.removeChildren(),o.getChild("n34").onClick(null,function(){var e=o.getChild("n12").text,t=o.getChild("n7").text;return e||t?(_socket.sendp({c:"userInfo",id:e,nickname:t}),fairygui.GRoot.inst.showModalWait(),void netmsg.once("userInfo",null,function(e){fairygui.GRoot.inst.closeModalWait(),l.removeChildren();var t=fairygui.UIPackage.createObject("Package1","Component6");l.addChild(t),t.getChild("userInfo").getChild("n45").url=e.face,t.getChild("n4").text=e.nickname,t.getChild("n7").text=e.showId,t.getChild("n9").text=s(e.coins),t.getChild("n19").text=s(e.savedMoney||0);var n=t.getChild("n3");n.on("input",null,function(){var e=n.text.replace(/ /g,"");n.text=s(e)});var i=t.getChild("n16");i.on("input",null,function(){var e=i.text.replace(/ /g,"");i.text=s(e)});var o=t.getChild("n10"),a=t.getChild("n11");e.block&&new Date(e.block)>new Date&&(o.selected=!0),e.nochat&&new Date(e.nochat)>new Date&&(a.selected=!0),t.getChild("n2").onClick(null,function(){var n=t.getChild("n3").text.replace(/ /g,"");if(n=Number(n),!isNaN(n)&&n){var i=c(t.getChild("n9").text);if(n<0){if(!confirm("确定要减钱？？！"))return;i+n<0&&(tipon("减分过多，自动调整成"+-i).popup(),n=-i)}if(0==n)return void(t.getChild("n3").text="");_socket.sendp({c:"admin.addcoins",userid:e.id,coins:n}),netmsg.once("admin.addcoins",null,function(e){e.err||(t.getChild("n3").text="",t.getChild("n9").text=s(e.newcoin))})}}),t.getChild("n15").onClick(null,function(){var n=i.text.replace(/ /g,"");if(n=Number(n),!isNaN(n)&&n){var o=c(t.getChild("n19").text);if(n<0){if(!confirm("确定要减钱？？！"))return;o+n<0&&(tipon("减分过多，自动调整成"+-o).popup(),n=-o)}if(0==n)return void(i.text="");_socket.sendp({c:"admin.addsaved",userid:e.id,coins:n}),netmsg.once("admin.addsaved",null,function(e){e.err||(i.text="",t.getChild("n19").text=s(e.newcoin))})}}),o.onClick(null,function(){_socket.sendp({c:"admin.block",userid:e.id,t:o.selected?315532748958:0})}),a.onClick(null,function(){_socket.sendp({c:"admin.nochat",userid:e.id,t:a.selected?315532748958:0})}),t.getChild("n13").onClick(null,function(){_socket.sendp({c:"admin.resetpwd",userid:e.id}),netmsg.once("admin.resetpwd",null,function(e){e.err||prompt("密码已修改，请复制之后发给玩家",e.newpwd)})}),t.getChild("n14").onClick(null,function(){_socket.sendp({c:"admin.resetsecpwd",userid:e.id}),netmsg.once("admin.resetsecpwd",null,function(e){e.err||tipon("密保已重置").popup()})})})):(o.getChild("n12").displayObject.prompt="id或者昵称必须填写一个",o.getChild("n12").text="",void(o.getChild("n7").text=""))});var d=o.getChild("n49");d.setVirtual(),o.getChild("n47").onClick(null,function(){var e=o.getChild("n44").text,t=o.getChild("n40").text;if(e){if(e=new Date(e),"Invalid Date"==e)return o.getChild("n44").text="",void(o.getChild("n44").displayObject.prompt="类似2017-6-7 00:00:00")}else{var n=new Date;e=new Date(""+n.getFullYear()+"-"+(n.getMonth()+1)+"-1")}if(t){if(t=new Date(t),"Invalid Date"==t)return o.getChild("n44").text="",void(o.getChild("n44").displayObject.prompt="类似2017-6-7 12:00:00")}else t=new Date;fairygui.GRoot.inst.showModalWait(),_socket.sendp({c:"admin.addCoinsLog",start:e,end:t}),netmsg.once("admin.addCoinsLog",null,function(e){fairygui.GRoot.inst.closeModalWait(),d.itemRenderer=g.create(null,function(t,n){var i=e.logs[t];n.getChild("n1").text=r.toDateString(i.time),n.getChild("n3").text=i.targetName,n.getChild("n2").text=s(i.coins),n.getChild("n4").text=i.operatorName,n.getChild("n5").text=i.type||""},null,!1),d.numItems=e.logs.length;for(var t=0,n=0;n<e.logs.length;n++)t+=e.logs[n].coins;o.getChild("n51").text="总计 "+s(t)})}),o.getChild("n3").onClick(n,n.enterGame),o.getChild("n62").onClick(null,function(){main({showlogin:!0})}),i(null,n)}))}}]),e}();e.exports=f.create},162:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(93),r=function(){function e(t){i(this,e),this.view=t,this.roadBeadPlate=t.getChildAt(0).asCom,this.cols=this._orgCols=Math.max(9,Math.ceil(this.view.width/27)),this.roadBeadPlate.getChild("n90").asList.removeChildren()}return l(e,[{key:"refreshRoad",value:function(e){var t=this.roadBeadPlate.getChild("n90").asList;t.removeChildren();var n=Math.floor(e.length/6)+1,i=Math.max(n,this._orgCols);this.cols=i,n>=this._orgCols?this.view.scrollPane.setPosX(this.roadBeadPlate.width-this.view.width):this.view.scrollPane.setPosX(0);for(var o=t._children.length;o<e.length;o++){var l=fairygui.UIPackage.createObject("Package1","路格1"),a=e[o],r=l.getController("c1");if(r.selectedIndex=0,!a)return;"banker"==a.win?r.selectedIndex=1:"player"==a.win?r.selectedIndex=2:r.selectedIndex=3,a.demo?l.getTransition("t0").play():l.getTransition("t0").stop(),l.getChild("n6").visible=a.bankerPair,l.getChild("n7").visible=a.playerPair,t.addChild(l)}}},{key:"cols",get:function(){return this._cols},set:function(e){this._cols=e,this.roadBeadPlate.width=28*this._cols+1}}]),e}(),s=function(){function e(t){i(this,e),this.view=t,this.roadBig=t.getChildAt(0).asCom,this.cols=this._orgCols=Math.max(24,Math.ceil(this.view.width/13))}return l(e,[{key:"bigRoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.columns,t.rows),i=void 0===n?6:n,o=[],l={},r=0,s=void 0,c=[],d=0;return e.forEach(function(e){if("tie"===e.win)o.push(e);else{if(s){var t=a.last(c);"tie"===s.win&&t&&(t.ties=a.cloneDeep(o),o=[],s=t.result),t&&s.win&&s.win!==e.win&&r++}for(var n=r,u=0,h=!1;!h;){var g=n+"."+u,f=n+"."+(u+1);if(a.get(l,g))u+1>=i?n++:a.get(l,f)?a.get(l,f).result.win===e.win?u++:n++:u++;else{var m=a.merge({},{row:u,column:n,logicalColumn:r,ties:a.cloneDeep(o)},{result:e});a.set(l,g,m),c.push(l[n][u]),h=!0}}o=[],d=Math.max(d,n)}s=e}),a.isEmpty(c)&&o.length>0?c.push({ties:a.cloneDeep(o),column:0,row:0,logicalColumn:0,result:{}}):!a.isEmpty(c)&&o.length&&(a.last(c).ties=a.cloneDeep(o)),c.maximumColumnReached=d,c}},{key:"logicalRoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.columns,t.rows,[]),i=0,o=void 0;return e.forEach(function(e){"tie"!==e.win&&(o&&o.win&&o.win!==e.win&&i++,n[i]?n[i].push({result:e}):n[i]=[{result:e}],o=e)}),n}},{key:"refreshRoad",value:function(e){var t=this.roadBig,n=this.bigRoad(e),i=Math.max(n.maximumColumnReached,this._orgCols);this.cols=2*Math.floor(i/2)+2,n.maximumColumnReached>=this._orgCols?this.view.scrollPane.setPosX(this.roadBig.width-this.view.width):this.view.scrollPane.setPosX(0),t.removeChildren(2);for(var o=0;o<n.length;o++){var l=fairygui.UIPackage.createObject("Package1","路格2"),a=n[o].result,r=l.getController("c1");null==a.win?r.selectedIndex=0:"banker"==a.win?r.selectedIndex=1:"player"==a.win&&(r.selectedIndex=2),a.demo?l.getTransition("t0").play():l.getTransition("t0").stop(),l.getChild("n68").visible=a.bankerPair,l.getChild("n69").visible=a.playerPair,l.getChild("n72").visible=null!=n[o].ties&&n[o].ties.length>0,l.x=14*n[o].column+2,l.y=14*n[o].row+2,t.addChild(l)}}},{key:"cols",get:function(){return this._cols},set:function(e){this._cols=e,this.roadBig.width=14*this._cols+1}}]),e}(),c=function(){function e(t,n,o){i(this,e),this.view=t,this.road=t.getChildAt(0).asCom,this.circle=n||1,this.cols=this._orgCols=o||Math.max(24,Math.ceil(this.view.width/7))}return l(e,[{key:"makeResult",value:function(e,t){return e<=t?"red":e==t+1?"blue":"red"}},{key:"reverseResult",value:function(e){return"red"==e?"blue":"red"}},{key:"bigEye",value:function(e,t){for(var n=[],i=this.circle;i<e.length;i++){var o=e[i],l=i-this.circle,a=e[l].length-1,r=l-1;if(r>=0){var s=e[r].length-1,c=a+1;n.push(this.reverseResult(this.makeResult(c,s)))}for(var d=1;d<o.length;d++)n.push(this.makeResult(d,a))}return n[n.length-1]={color:n[n.length-1],isDemo:t},this.turn2Map(n)}},{key:"turn2Map",value:function(e){var t=6,n={},i=0,l=void 0,r=[],s=0;return e.forEach(function(e){var c;"object"==("undefined"==typeof e?"undefined":o(e))&&(c=e.isDemo,e=e.color),l&&l!=e&&i++;for(var d=i,u=0,h=!1;!h;){var g=d+"."+u,f=d+"."+(u+1);if(a.get(n,g))u+1>=t?d++:a.get(n,f)?a.get(n,f).result===e?u++:d++:u++;else{var m=a.merge({},{row:u,column:d,logicalColumn:i},{result:e,isDemo:c});a.set(n,g,m),r.push(n[d][u]),h=!0}}l=e,s=Math.max(s,d)}),r.maximumColumnReached=s,r}},{key:"refreshRoad",value:function(e,t){var n=this.road,i=this.bigEye(e,t),o=Math.max(i.maximumColumnReached,this._orgCols);this.cols=2*Math.round(o/2+1),i.maximumColumnReached>=this._orgCols?this.view.scrollPane.setPosX(n.width-this.view.width):this.view.scrollPane.setPosX(0),n.removeChildren(2);for(var l=0;l<i.length;l++){var a=fairygui.UIPackage.createObject("Package1","路格"+(2+this.circle)),r=i[l].result,s=i[l].isDemo,c=a.getController("c1");"red"==r?c.selectedIndex=0:c.selectedIndex=1,s?a.getTransition("t0").play():a.getTransition("t0").stop(),a.x=7*i[l].column+1,a.y=7*i[l].row+1,n.addChild(a)}}},{key:"cols",get:function(){return this._cols},set:function(e){this._cols=e,this.road.width=7*this._cols+1}}]),e}();e.exports={BeadPlate:r,BigRoad:s,BigEye:c}}});